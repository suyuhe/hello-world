<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Chinatown, Vancouver Map</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }

</style>
</head>
<body>
<style>
#menu {
background: #fff;
position: absolute;
z-index: 1;
top: 10px;
right: 55px;
border-radius: 3px;
width: 120px;
border: 1px solid rgba(0, 0, 0, 0.4);
font-family: 'Open Sans', sans-serif;
}

#menu a {
font-size: 13px;
color: #404040;
display: block;
margin: 0;
padding: 0;
padding: 10px;
text-decoration: none;
border-bottom: 1px solid rgba(0, 0, 0, 0.25);
text-align: center;
}

#menu a:last-child {
border: none;
}

#menu a:hover {
background-color: #f8f8f8;
color: #404040;
}

#menu a.active {
background-color: #3887be;
color: #ffffff;
}

#menu a.active:hover {
background: #3074a4;
}

.features {
  background-color: rgb(246,246,246, 0.75);
  border-radius: 3px;
  top: 10px;
  left: 50px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  font: 14px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  padding: 5px;
  position: absolute;
  z-index: 1;
}

.mapboxgl-popup {
max-width: 400px;
font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
</style>

<nav id="menu"></nav>
<div id="map"></div>
<div id='features' class=features>
  <h4>CHINATOWN, VANCOUVER TOUR</h4>Welcome to Chinatown! <br>Come along for a tour with me as I do errands in the neighbourhood. <br>We will be thinking about contested space, placemaking, and <br>displacement, as well as visiting some of my favourite spots.<br>Toggle the layers on the right.</div>

<script>
	mapboxgl.accessToken = 'pk.eyJ1Ijoic3V5dWhlIiwiYSI6ImNrbHNmZndyNjBlY3Uybm8xNmZnZXJpazAifQ.IZA0sJHchmn7ons_NxGJtg';
var map = new mapboxgl.Map({
container: 'map',
style: 'mapbox://styles/suyuhe/ckmjovho43x9f17ny3bodjpiu',
center: [-123.09966588994256, 49.28041868921334],
zoom: 15.5
});

map.addControl(new mapboxgl.NavigationControl());

map.on('load', function () {
  map.addSource('strathcona', {
  type: 'vector',
  url: 'mapbox://suyuhe.ckml5mv6v0beu29p9ru1a0myc-2q4yi'
  });
  map.addLayer({
  'id': 'strathcona',
  'type': 'fill',
  'source': 'strathcona',
  'layout': {
  // make layer visible by default
  'visibility': 'visible'
  },
  'paint': {
    "fill-color": "rgba(255, 237, 158, 0.5)"
  },
  'source-layer': 'strathcona'
  });

  map.addSource('downtown', {
  type: 'vector',
  url: 'mapbox://suyuhe.ckmljkkdm08ed20mgq6vpxduy-837y9'
  });
  map.addLayer({
  'id': 'downtown',
  'type': 'fill',
  'source': 'downtown',
  'layout': {
  // make layer visible by default
  'visibility': 'visible'
  },
  'paint': {
    "fill-color": "rgba(254, 178, 77, 0.5)"
  },
  'source-layer': 'downtown'
  });

  // add source and layer for contours
  map.addSource('Path', {
  type: 'vector',
  url: 'mapbox://suyuhe.ckmlh01at160i27phl7xqa6di-1hho9'
  });
  map.addLayer({
  'id': 'Path',
  'type': 'line',
  'source': 'Path',
  'source-layer': 'Path',
  'layout': {
  // make layer visible by default
  'visibility': 'visible',
  },
  'paint': {
  'line-color': '#ef64aa',
  'line-width': 4
  }
  });

map.addSource('places', {
'type': 'geojson',
'data': {
'type': 'FeatureCollection',
'features': [
{
'type': 'Feature',
'properties': {
'description':
'<strong>Fuling Gifts & Houseware</strong><p>We will need a pot for our new houseplants. Owned by Mr. Wong, Fuling Gifts & Houseware has an assortment of trinkets to look through from teapots to chess sets to incense papers.</p>',
'icon': 'convenience'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.1018529169811, 49.28067055845951]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>Bamboo Village</strong><p>Lets pick up some house plants! Bamboo Village is a cute family-owned plant and homegoods store, operating for over 35 years.</p>',
'icon': 'garden'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.10106987280442, 49.280648460478545]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>Sunrise Market</strong><p>To pick up some groceries, we will head to Sunrise Market, a cheap, high quality, family-owned grocery store. Sunrise Market is the creator of Sunrise Soya Foods, one of the top producers of tofu in Canada. The market is located in historical Japantown. During World War II, Japanese-Canadians were interned and had their property ceased, leading to the destruction of Japantown as a distinct neighbourhood.</p>',
'icon': 'convenience'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.09749014600008, 49.283055813712274]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>Wing Sang Building</strong><p>The <a href="http://ballstonarts-craftsmarket.blogspot.com/" target="_blank" title="Opens in a new window">Ballston Arts & Crafts Market</a> sets up shop next to the Ballston metro this Saturday for the first of five dates this summer. Nearly 35 artists and crafters will be on hand selling their wares. 10:00-4:00 p.m.</p>',
'icon': 'art-gallery'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.1031638880179, 49.28086745495861]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>Hogans Alley</strong><p>Hogans Alley is a historical African-Canadian immigrant neighbourhood of the 1900s, and a center of historic jazz. During the mid-1900s, the neighbourhood was subject to racist and classist urban renewal practices. The neighbourhood was torn to make way for the Georgia Viaduct seen today. Now, the City plans to remove the Viaduct to create the <a href="https://vancouver.ca/files/cov/northeast-false-creek-plan.pdf" target="_blank" title="Opens in a new window">Northeast False Creek neighbourhood and revitalize Hogans Alley</a>. <a href="https://www.youtube.com/watch?v=B-8lgpvj0Hg" target="_blank" title="Opens in a new window">Learn more here</a>. </p>',
'icon': 'landmark'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.09961497712767, 49.277823489243815]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>Dollar Meat Store</strong><p>Chinese BBQ meats are a staple cultural and community food. In 1968, the BC Health Ministry deemed Chinese BBQ meats unsaniyaty due to the implementation of new meat storage temperature laws. Selectively racist application of these laws led to 5 shops temporarily closed. The Chinatown community erupted in protests, leading to BBQ meats taken to federal health department for inspection.</p>',
'icon': 'shop'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.09802417129438, 49.28023969448907]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>Maxims Bakery</strong><p>Stop by this local Cantonese bakery and and pick up some pastries.</p>',
'icon': 'bakery'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.09786121844371, 49.279633181570986]
}
},
{
'type': 'Feature',
'properties': {
'description':
'<strong>105 Keefer St</strong><p>In 2014, Beedie Living proposed the redevelopment of 105 Keefer St to a 12-storey condominium. Local residents and seniors protested against the gentrifying development fighting for 100% affordable housing. In a historic win, the development was rejected by the City of Vancouver in 2017, the first time in 10 years.</p>',
'icon': 'farm'
},
'geometry': {
'type': 'Point',
'coordinates': [-123.09955084424871, 49.27965772110093]
}
}
]
}
});
// Add a layer showing the places.
map.addLayer({
'id': 'places',
'type': 'symbol',
'source': 'places',
'layout': {
'icon-image': '{icon}-15',
'icon-allow-overlap': true
}
});

// enumerate ids of the layers
var toggleableLayerIds = ['Path', 'strathcona', 'downtown'];

// set up the corresponding toggle button for each layer
for (var i = 0; i < toggleableLayerIds.length; i++) {
var id = toggleableLayerIds[i];

var link = document.createElement('a');
link.href = '#';
link.className = 'active';
link.textContent = id;

link.onclick = function (e) {
var clickedLayer = this.textContent;
e.preventDefault();
e.stopPropagation();

var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

// toggle layer visibility by changing the layout object's visibility property
if (visibility === 'visible') {
map.setLayoutProperty(clickedLayer, 'visibility', 'none');
this.className = '';
} else {
this.className = 'active';
map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
}
};

var layers = document.getElementById('menu');
layers.appendChild(link);
}

// When a click event occurs on a feature in the places layer, open a popup at the
// location of the feature, with description HTML from its properties.
map.on('click', 'places', function (e) {
var coordinates = e.features[0].geometry.coordinates.slice();
var description = e.features[0].properties.description;

// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;

}

new mapboxgl.Popup()
.setLngLat(coordinates)
.setHTML(description)
.addTo(map);

map.flyTo({
center: e.features[0].geometry.coordinates
});
});

// Change the cursor to a pointer when the mouse is over the places layer.
map.on('mouseenter', 'places', function () {
map.getCanvas().style.cursor = 'pointer';
});

// Change it back to a pointer when it leaves.
map.on('mouseleave', 'places', function () {
map.getCanvas().style.cursor = '';
});
});
</script>

</body>
</html>
